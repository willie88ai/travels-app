<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÂÆúËò≠ÂÜ¨Êó•ÊÖ¢ÊóÖ (Èõ≤Á´ØÂçî‰ΩúÁâà)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Zen+Maru+Gothic:wght@400;700&display=swap');
        body { font-family: 'Zen Maru Gothic', 'Noto Sans TC', sans-serif; background-color: #F5F5F0; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5); }
        /* Á∑®ËºØÊ®°Âºè‰∏ãÁöÑËº∏ÂÖ•Ê°ÜÊ®£Âºè */
        .edit-input { background: #fff; border: 2px solid #C66B3D; border-radius: 4px; padding: 2px 4px; width: 100%; color: #333; font-size: 0.9rem; }
        .edit-input-time { width: 60px; text-align: center; }
    </style>
    <script>
        tailwind.config = {
            theme: { extend: { colors: { 'jp-black': '#2C2C2C', 'jp-gray': '#8E8E8E', 'jp-beige': '#F5F5F0', 'jp-accent': '#C66B3D', 'jp-green': '#5F7161', 'jp-blue': '#6D8494' } } }
        }
    </script>
</head>
<body class="text-jp-black antialiased">
    <div id="app" class="max-w-md mx-auto min-h-screen bg-jp-beige relative pb-24 shadow-2xl overflow-hidden">
        
        <header class="pt-12 pb-4 px-6 bg-white rounded-b-3xl shadow-sm sticky top-0 z-10">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold tracking-widest text-jp-black">ÂÆúËò≠ÂÜ¨ÊóÖ <span v-if="isEditing" class="text-sm text-jp-accent animate-pulse">(Á∑®ËºØ‰∏≠)</span></h1>
                    <p class="text-xs text-jp-gray mt-1 tracking-wider">Dec 13 - 16, 2025</p>
                </div>
                <div class="flex items-center gap-2">
                    <div v-if="isLoading" class="text-xs text-gray-400"><i class="fas fa-sync fa-spin"></i></div>
                    <div class="w-10 h-10 rounded-full bg-jp-green text-white flex items-center justify-center shadow-md">
                        <i class="fas fa-leaf"></i>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 flex items-center rounded-xl p-3 text-sm transition-colors duration-500" :class="weather.bgClass">
                <i :class="weather.icon" class="mr-3 text-lg transition-all duration-500"></i>
                <div class="flex-1">
                    <span class="block font-bold">ÂÆúËò≠ÁèæÊ≥ÅÔºö{{ weather.desc }} {{ weather.temp }}</span>
                    <span class="text-xs text-gray-500">{{ weather.rainProb }}</span>
                </div>
            </div>
        </header>

        <main class="p-4 space-y-4">
            
            <div v-if="currentTab === 'schedule'">
                <div class="flex space-x-2 overflow-x-auto no-scrollbar mb-4 pb-1">
                    <button v-for="(day, index) in tripData.days" :key="index" @click="currentDay = index"
                        :class="currentDay === index ? 'bg-jp-black text-white shadow-lg' : 'bg-white text-gray-400'"
                        class="flex-shrink-0 px-5 py-3 rounded-2xl transition-all duration-300 flex flex-col items-center min-w-[80px]">
                        <span class="text-xs font-light">Day {{ index + 1 }}</span>
                        <span class="text-lg font-bold">{{ day.date }}</span>
                    </button>
                </div>

                <div v-if="tripData.days && tripData.days.length > 0" class="space-y-4 pb-20">
                    <div v-for="(item, idx) in tripData.days[currentDay].events" :key="idx" 
                         class="glass-card rounded-2xl p-5 relative overflow-hidden transition-all duration-200">
                        <div class="absolute left-0 top-0 bottom-0 w-1" :class="getCategoryColor(item.type)"></div>

                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center space-x-2 w-full">
                                <input v-if="isEditing" v-model="item.time" class="edit-input edit-input-time font-bold" placeholder="ÊôÇÈñì">
                                <span v-else class="px-2 py-1 rounded-md text-xs font-bold bg-gray-100 text-gray-600">{{ item.time }}</span>
                                <span class="text-xs text-gray-400 border border-gray-200 px-1 rounded whitespace-nowrap">{{ item.categoryLabel }}</span>
                            </div>
                            <a v-if="!isEditing" :href="'https://www.google.com/maps/search/?api=1&query=' + item.location" target="_blank" 
                               class="text-jp-blue hover:bg-blue-50 p-2 rounded-full transition">
                                <i class="fas fa-location-arrow text-lg"></i>
                            </a>
                        </div>

                        <div class="mb-1">
                            <input v-if="isEditing" v-model="item.title" class="edit-input font-bold text-lg mb-1" placeholder="Ë°åÁ®ãÊ®ôÈ°å">
                            <h3 v-else class="text-lg font-bold mb-1">{{ item.title }}</h3>
                        </div>

                        <div class="mb-3">
                            <input v-if="isEditing" v-model="item.location" class="edit-input text-sm mb-1" placeholder="Âú∞Èªû(Â∞éËà™Áî®)">
                            <p v-else class="text-sm text-gray-500 mb-3 flex items-center">
                                <i class="fas fa-map-marker-alt text-xs mr-1 w-4 text-center"></i> {{ item.location }}
                            </p>
                        </div>

                        <div class="flex flex-wrap gap-2 mt-3 mb-2">
                            <span v-for="tag in item.tags" :key="tag.text" :class="getTagStyle(tag.type)" class="text-xs px-2 py-1 rounded-lg border flex items-center">
                                <i :class="tag.icon" class="mr-1"></i> {{ tag.text }}
                            </span>
                        </div>

                        <div class="mt-3 pt-3 border-t border-dashed border-gray-200">
                            <textarea v-if="isEditing" v-model="item.note" class="edit-input text-xs" rows="2" placeholder="ÂÇôË®ª"></textarea>
                            <p v-else class="text-xs text-gray-500 leading-relaxed">
                                <i class="fas fa-info-circle text-jp-accent mr-1"></i> {{ item.note }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'budget'" class="pb-20">
                <div class="bg-white rounded-2xl p-6 shadow-sm mb-4 text-center">
                    <p class="text-sm text-gray-400 mb-1">Á∏ΩËä±Ë≤ª (TWD)</p>
                    <h2 class="text-4xl font-bold text-jp-black font-mono">{{ formatCurrency(totalBudget) }}</h2>
                </div>

                <div class="bg-white rounded-2xl p-4 shadow-sm mb-4">
                    <h3 class="text-sm font-bold mb-3 text-gray-600">Êñ∞Â¢ûÊîØÂá∫ (ÂÖ±ÂêåÁ∑®ËºØ)</h3>
                    <div class="flex space-x-2 mb-2">
                        <input v-model="newExpense.item" placeholder="È†ÖÁõÆ" class="flex-1 bg-gray-50 rounded-lg px-3 py-2 text-sm outline-none focus:ring-1 ring-jp-green">
                        <input v-model="newExpense.amount" type="number" placeholder="$" class="w-24 bg-gray-50 rounded-lg px-3 py-2 text-sm outline-none focus:ring-1 ring-jp-green">
                    </div>
                    <button @click="addExpense" class="w-full bg-jp-black text-white rounded-lg py-2 text-sm font-bold active:bg-gray-700 transition">
                        <i class="fas fa-plus mr-1"></i> Ë®ò‰∏ÄÁ≠Ü
                    </button>
                </div>

                <div class="space-y-2">
                    <div v-for="(expense, idx) in tripData.expenses" :key="idx" class="bg-white px-4 py-3 rounded-xl flex justify-between items-center shadow-sm">
                        <span class="text-sm font-medium">{{ expense.item }}</span>
                        <div class="flex items-center space-x-3">
                            <span class="font-mono font-bold text-jp-green">{{ formatCurrency(expense.amount) }}</span>
                            <button @click="removeExpense(idx)" class="text-gray-300 hover:text-red-400"><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                    <div v-if="!tripData.expenses || tripData.expenses.length === 0" class="text-center text-gray-400 text-xs py-8">
                        ÁõÆÂâçÈÇÑÊ≤íÊúâË®òÂ∏≥Âñî
                    </div>
                </div>
            </div>
        </main>

        <button v-if="currentTab === 'schedule'" @click="toggleEdit" 
                :class="isEditing ? 'bg-jp-accent rotate-0' : 'bg-jp-black'"
                class="fixed bottom-24 right-6 w-14 h-14 rounded-full text-white shadow-2xl flex items-center justify-center transition-all duration-300 z-50 text-xl">
            <i :class="isEditing ? 'fas fa-save' : 'fas fa-pen'"></i>
        </button>

        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-8 py-3 flex justify-around items-center z-50 max-w-md mx-auto rounded-t-2xl shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
            <button @click="currentTab = 'schedule'" :class="currentTab === 'schedule' ? 'text-jp-black' : 'text-gray-300'" class="flex flex-col items-center transition">
                <i class="fas fa-map-marked-alt text-xl mb-1"></i>
                <span class="text-[10px] font-bold">Ë°åÁ®ã</span>
            </button>
            <div class="w-px h-8 bg-gray-100"></div>
            <button @click="currentTab = 'budget'" :class="currentTab === 'budget' ? 'text-jp-black' : 'text-gray-300'" class="flex flex-col items-center transition">
                <i class="fas fa-calculator text-xl mb-1"></i>
                <span class="text-[10px] font-bold">Ë®òÂ∏≥</span>
            </button>
        </nav>
    </div>

    <script>
        // ==========================================
        // üî• ÈáçË¶ÅÔºöË´ãÂú®ÈÄôË£°Â°´ÂÖ•‰Ω†ÁöÑ Firebase Config
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyAv9Q6XuB-XL8s5-p8_xU6iTHMpm9Toy5E",
            authDomain: "yilan-trip-c1069.firebaseapp.com",
            projectId: "yilan-trip-c1069",
            storageBucket: "yilan-trip-c1069.firebasestorage.app",
            messagingSenderId: "754631881000",
            appId: "1:754631881000:web:8d25bf3cad2e800557201d"
        };

        // ÂàùÂßãÂåñ Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const { createApp } = Vue

        createApp({
            data() {
                return {
                    currentTab: 'schedule',
                    currentDay: 0,
                    isLoading: true,
                    isEditing: false, // Á∑®ËºØÊ®°ÂºèÁãÄÊÖã
                    newExpense: { item: '', amount: '' },
                    weather: { temp: '--', desc: 'ËºâÂÖ•‰∏≠...', rainProb: '', icon: 'fas fa-spinner fa-spin text-gray-400', bgClass: 'bg-gray-50' },
                    
                    // ÈÄôÊòØÊúÉÂêåÊ≠•Âà∞Èõ≤Á´ØÁöÑÂÆåÊï¥Ë≥áÊñôÁâ©‰ª∂
                    tripData: {
                        days: [],
                        expenses: []
                    },

                    // üî• ÊúÄÊñ∞ÁâàÈ†êË®≠Ë°åÁ®ã (Â¶ÇÊûúÈõ≤Á´ØÊòØÁ©∫ÁöÑÔºåÊúÉÁî®ÈÄôÁµÑÂàùÂßãÂåñ)
                    defaultDays: [
                        {
                            date: '12/13 (ÂÖ≠)',
                            events: [
                                { time: '10:30', type: 'spot', title: 'Ëò≠ÈôΩÂãïÊ§çÁâ©ÁéãÂúã', location: 'Ëò≠ÈôΩÂãïÊ§çÁâ©ÁéãÂúã', categoryLabel: 'ÊôØÈªû', tags: [{type: 'highlight', text: 'Ê∞¥Ë±ö‰∫íÂãï', icon: 'fas fa-paw'}, {type: 'photo', text: 'Ë¢ãÈº†/ÁæäÈßù', icon: 'fas fa-camera'}], note: 'Á¨¨‰∏ÄÁ´ôÂÖà‰æÜÁôÇÁôí‰∏Ä‰∏ãÔºÅ' },
                                { time: '14:00', type: 'stay', title: 'Êó•ÂÖâÁ∂†ÁØâ Check-in', location: 'Êó•ÂÖâÁ∂†ÁØâ LOHERB', categoryLabel: '‰ΩèÂÆø', tags: [{type: 'chill', text: 'ÁîüÊÖãÊ±†‰∏ãÂçàËå∂', icon: 'fas fa-coffee'}], note: '‰∫´ÂèóÊ∏°ÂÅáÊ∞õÂúçÔºåË∂ÅÂ§©‰∫ÆÊãçÁæéÁÖß„ÄÇ' },
                                { time: '16:30', type: 'spot', title: 'ÂÜ¨Â±±Ê≤≥ÁîüÊÖãÁ∂†Ëàü', location: 'ÂÜ¨Â±±Ê≤≥ÁîüÊÖãÁ∂†Ëàü', categoryLabel: 'ÊôØÈªû', tags: [{type: 'highlight', text: 'Á•ûÁßòÊ≤≥ÈÅì', icon: 'fas fa-star'}], note: 'ÂÇçÊôöÈªûÁáàÂæåÈùûÂ∏∏Êµ™Êº´„ÄÇ' },
                                { time: '18:00', type: 'food', title: 'È¶ôÂªöËá≠Ë±ÜËÖê', location: 'È¶ôÂªöÁ±≥Á≤âÁæπ', categoryLabel: 'Â∞èÂêÉ', tags: [{type: 'food', text: 'ÊúâÊ©üÁ∂†Ëá≠Ë±ÜËÖê', icon: 'fas fa-utensils'}], note: 'Âú®Âú∞‰∫∫Êé®Ëñ¶ÔºåÂøÖÂêÉËá≠Ë±ÜËÖêË∑üÁ±≥Á≤âÁæπ„ÄÇ' },
                                { time: '19:30', type: 'food', title: 'ÁæÖÊù±Â§úÂ∏Ç', location: 'ÁæÖÊù±Â§úÂ∏Ç', categoryLabel: 'ÊôöÈ§ê', tags: [{type: 'food', text: 'ÈòøÁÅ∂‰ºØ', icon: 'fas fa-utensils'}, {type: 'food', text: 'Â∞èÊò•ÂçúËÇâ', icon: 'fas fa-drumstick-bite'}], note: '‰∫∫Â§öÂ∞èÂøÉÈå¢ÂåÖÔºåÂª∫Ë≠∞ÂÅúÁ´ãÈ´îÂÅúËªäÂ†¥„ÄÇ' }
                            ]
                        },
                        {
                            date: '12/14 (Êó•)',
                            events: [
                                { time: '08:00', type: 'trans', title: 'Âá∫ÁôºÂâçÂæÄÂ§™Âπ≥Â±±', location: 'Â§™Âπ≥Â±±ÂúãÂÆ∂Ê£ÆÊûóÈÅäÊ®ÇÂçÄ', categoryLabel: '‰∫§ÈÄö', tags: [{type: 'warn', text: 'ÂÆπÊòìÊöàËªä', icon: 'fas fa-pills'}], note: 'ËªäÁ®ã 1.5hrÔºåÂ±±Ë∑ØËúøËúí„ÄÇ' },
                                { time: '09:30', type: 'spot', title: 'Ë¶ãÊô¥Êá∑Âè§Ê≠•ÈÅì', location: 'Ë¶ãÊô¥Êá∑Âè§Ê≠•ÈÅì', categoryLabel: 'ÊôØÈªû', tags: [{type: 'highlight', text: 'ÂÖ®ÁêÉÊúÄÁæéÂ∞èË∑Ø', icon: 'fas fa-tree'}], note: 'ÈúßÊ∞£ÈáçË®òÂæó‰øùÊöñ„ÄÇ' },
                                { time: '14:30', type: 'spot', title: 'Ê∏ÖÊ∞¥Âú∞ÁÜ±ÂÖ¨Âúí', location: 'Ê∏ÖÊ∞¥Âú∞ÁÜ±ÂÖ¨Âúí', categoryLabel: 'È´îÈ©ó', tags: [{type: 'food', text: 'ÁÖÆÊ∫´Ê≥âËõã', icon: 'fas fa-egg'}, {type: 'chill', text: 'ÂÖçË≤ªË∂≥ÊπØ', icon: 'fas fa-hot-tub'}], note: 'Ë®òÂæóÁßüÁ´πÁ∞çÔºåËá™ÂÇôÊØõÂ∑æ„ÄÇ' },
                                { time: '18:30', type: 'food', title: 'ÂæÆÁ¨ëÈ£üÂÆ¢', location: 'ÂæÆÁ¨ëÈ£üÂÆ¢', categoryLabel: 'ÊôöÈ§ê', tags: [{type: 'highlight', text: 'Âú®Âú∞È£üÊùêÁ∞°È§ê', icon: 'fas fa-utensils'}], note: 'Â∑≤È†êÂÆöÁõÆÊ®ôÔºåÊ∞£Ê∞õÊ∫´È¶®„ÄÇ' },
                                { time: '20:30', type: 'spot', title: 'Á©∫„ÑüËæ≤Â†¥Â§úÊôØ', location: 'Á©∫„ÑüËæ≤Â†¥', categoryLabel: 'Â§úÊôØ', tags: [{type: 'photo', text: 'ÁôæËê¨Â§úÊôØ', icon: 'fas fa-star'}], note: 'ÈúÄÂú®Â±±‰∏ãÊê≠‰πòÊé•ÈßÅËªä‰∏äÂ±±ÔºåÊä´Ëñ©Â•ΩÂêÉ„ÄÇ' }
                            ]
                        },
                        {
                            date: '12/15 (‰∏Ä)',
                            events: [
                                { time: '12:00', type: 'food', title: 'Â°≠Â∫ïÁÉ§È≠ö', location: 'Â°≠Â∫ïÁÉ§È≠ö', categoryLabel: 'ÂçàÈ§ê', tags: [{type: 'food', text: 'ÈπΩÁÉ§È≠ö', icon: 'fas fa-fish'}], note: 'È≠öÂæàÂ§ßÈöªÔºåÂª∫Ë≠∞ÊèêÊó©Ë®Ç‰Ωç„ÄÇ' },
                                { time: '15:00', type: 'stay', title: 'Â±±ÂΩ¢Èñ£ Check-in', location: 'Á§ÅÊ∫™Â±±ÂΩ¢Èñ£Ê∫´Ê≥âÈ£ØÂ∫ó', categoryLabel: '‰ΩèÂÆø', tags: [{type: 'chill', text: 'ÊàøÂÖßÂ§ßÊπØÊ±†', icon: 'fas fa-bath'}, {type: 'chill', text: 'Â§ßÁúæË£∏ÊπØ', icon: 'fas fa-spa'}], note: 'ÂÖ•‰ΩèÂæåÂ∞±ÂæÖÂú®È£ØÂ∫ó‰∫´ÂèóË®≠ÊñΩÔºÅ' },
                                { time: '18:00', type: 'food', title: 'È£ØÂ∫óÊôöÈ§ê/‰ºëÊÅØ', location: 'Á§ÅÊ∫™Â±±ÂΩ¢Èñ£Ê∫´Ê≥âÈ£ØÂ∫ó', categoryLabel: 'ÊôöÈ§ê', tags: [{type: 'chill', text: 'ÊîæÈ¨Ü', icon: 'fas fa-wine-glass'}], note: '‰∏çÊÉ≥Âá∫ÈñÄÂ∞±Âè´Â§ñÈÄÅÊàñÂêÉÈ£ØÂ∫ó„ÄÇ' }
                            ]
                        },
                        {
                            date: '12/16 (‰∫å)',
                            events: [
                                { time: '09:00', type: 'food', title: 'È£ØÂ∫óË±™ËèØÊó©È§ê', location: 'Á§ÅÊ∫™Â±±ÂΩ¢Èñ£Ê∫´Ê≥âÈ£ØÂ∫ó', categoryLabel: 'Êó©È§ê', tags: [{type: 'highlight', text: 'ÂçäËá™Âä©Âºè', icon: 'fas fa-coffee'}], note: 'ÊÖ¢ÊÖ¢‰∫´Áî®Ëá≥11ÈªûÈÄÄÊàø„ÄÇ' },
                                { time: '11:00', type: 'trans', title: 'ÈÄÄÊàø & ÂâçÂæÄÂè∞‰∏≠', location: 'Â±ãÈ¶¨ÁáíËÇâ', categoryLabel: '‰∫§ÈÄö', tags: [{type: 'info', text: 'Èï∑ÈÄîËªäÁ®ã', icon: 'fas fa-car'}], note: 'Áõ¥Â•îÂè∞‰∏≠ÂêÉÁáíËÇâÔºÅ' },
                                { time: '13:30', type: 'food', title: 'Â±ãÈ¶¨ÁáíËÇâ', location: 'Â±ãÈ¶¨ÁáíËÇâ', categoryLabel: 'ÂçàÈ§ê', tags: [{type: 'highlight', text: 'ÈõûÊπØÂøÖÂñù', icon: 'fas fa-fire'}], note: 'ÂÆåÁæéÁöÑÊóÖÁ®ãEnding„ÄÇ' }
                            ]
                        }
                    ]
                }
            },
            mounted() {
                this.fetchRealTimeWeather();
                this.initRealtimeSync();
            },
            computed: {
                totalBudget() {
                    if (!this.tripData.expenses) return 0;
                    return this.tripData.expenses.reduce((sum, item) => sum + parseInt(item.amount || 0), 0);
                }
            },
            methods: {
                // ÂàùÂßãÂåñÈõ≤Á´ØÂêåÊ≠•
                initRealtimeSync() {
                    // ‰ΩøÁî®Âõ∫ÂÆöÁöÑÊñá‰ª∂ID 'yilan2025' Á¢∫‰øùÂÖ©‰∫∫ÈÄ£Âà∞Âêå‰∏ÄÂÄã
                    const docRef = db.collection('trips').doc('yilan2025');
                    
                    // Áõ£ËÅΩÊ®°Âºè (onSnapshot)ÔºöÂ∞çÊñπ‰∏ÄÊîπÔºåÊàëÈÄôË£°È¶¨‰∏äËÆä
                    docRef.onSnapshot((doc) => {
                        this.isLoading = false;
                        if (doc.exists) {
                            console.log("Èõ≤Á´ØË≥áÊñôÊõ¥Êñ∞:", doc.data());
                            this.tripData = doc.data();
                        } else {
                            // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°‰ΩøÁî®ÔºàÈõ≤Á´ØÊ≤íË≥áÊñôÔºâÔºåÊää‰∏äÈù¢ÁöÑ defaultDays ÂØ´ÈÄ≤Âéª
                            console.log("ÂàùÂßãÂåñÈõ≤Á´ØË≥áÊñôÂ∫´...");
                            this.tripData.days = this.defaultDays;
                            this.saveToCloud(); 
                        }
                    });
                },
                
                // ÂÑ≤Â≠òË≥áÊñôÂà∞Èõ≤Á´Ø
                saveToCloud() {
                    this.isLoading = true;
                    db.collection('trips').doc('yilan2025').set(this.tripData)
                        .then(() => {
                            this.isLoading = false;
                            console.log("ÂÑ≤Â≠òÊàêÂäü");
                        })
                        .catch((error) => {
                            console.error("ÂÑ≤Â≠òÂ§±Êïó", error);
                            alert("ÂÑ≤Â≠òÂ§±ÊïóÔºåË´ãÊ™¢Êü•Á∂≤Ë∑Ø");
                        });
                },

                // ÂàáÊèõÁ∑®ËºØÊ®°Âºè
                toggleEdit() {
                    // Â¶ÇÊûúÊòØÂæûÁ∑®ËºØÁãÄÊÖã->ÈóúÈñâÔºå‰ª£Ë°®Á∑®ËºØÂÆåÊàêÔºåË¶ÅÂ≠òÊ™î
                    if (this.isEditing) {
                        this.saveToCloud();
                    }
                    this.isEditing = !this.isEditing;
                },

                // Â§©Ê∞£ API
                async fetchRealTimeWeather() {
                    try {
                        const lat = 24.82; const long = 121.77;
                        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${long}&current=temperature_2m,weather_code,precipitation_probability&timezone=Asia%2FTaipei`;
                        const response = await fetch(url);
                        const data = await response.json();
                        const current = data.current;
                        const wmo = this.getWeatherInfo(current.weather_code);
                        this.weather = {
                            temp: Math.round(current.temperature_2m) + '¬∞C',
                            desc: wmo.desc,
                            rainProb: 'ÈôçÈõ®Ê©üÁéá ' + (current.precipitation_probability || 0) + '%',
                            icon: wmo.icon,
                            bgClass: wmo.bg
                        };
                    } catch (e) { console.error(e); }
                },

                // Ë®òÂ∏≥Áõ∏Èóú
                addExpense() {
                    if (!this.newExpense.item || !this.newExpense.amount) return;
                    if (!this.tripData.expenses) this.tripData.expenses = [];
                    this.tripData.expenses.push({ ...this.newExpense });
                    this.newExpense.item = '';
                    this.newExpense.amount = '';
                    this.saveToCloud(); // Á´ãÂç≥ÂêåÊ≠•
                },
                removeExpense(idx) {
                    this.tripData.expenses.splice(idx, 1);
                    this.saveToCloud(); // Á´ãÂç≥ÂêåÊ≠•
                },

                // ËºîÂä©ÂáΩÂºè
                getWeatherInfo(code) {
                    if (code === 0) return { desc: 'Êô¥Êúó', icon: 'fas fa-sun text-orange-400', bg: 'bg-orange-50' };
                    if (code >= 1 && code <= 3) return { desc: 'Â§öÈõ≤', icon: 'fas fa-cloud-sun text-blue-400', bg: 'bg-gray-50' };
                    if (code >= 51 && code <= 67) return { desc: 'Â∞èÈõ®', icon: 'fas fa-cloud-rain text-blue-500', bg: 'bg-blue-50' };
                    return { desc: 'Èô∞Â§©', icon: 'fas fa-cloud text-gray-500', bg: 'bg-gray-50' };
                },
                getCategoryColor(type) {
                    const colors = { stay: 'bg-jp-blue', food: 'bg-jp-accent', spot: 'bg-jp-green', trans: 'bg-gray-400', shop: 'bg-yellow-500' };
                    return colors[type] || 'bg-gray-400';
                },
                getTagStyle(type) {
                    const styles = {
                        highlight: 'bg-yellow-50 text-yellow-700 border-yellow-200',
                        food: 'bg-orange-50 text-orange-700 border-orange-200',
                        warn: 'bg-red-50 text-red-700 border-red-200',
                        info: 'bg-blue-50 text-blue-700 border-blue-200',
                        photo: 'bg-purple-50 text-purple-700 border-purple-200',
                        chill: 'bg-teal-50 text-teal-700 border-teal-200',
                        shop: 'bg-pink-50 text-pink-700 border-pink-200'
                    };
                    return styles[type] || 'bg-gray-50 text-gray-600';
                },
                formatCurrency(val) { return '$' + val.toLocaleString(); }
            }
        }).mount('#app')
    </script>
</body>
</html>
